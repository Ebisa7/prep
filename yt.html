<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LT AI</title>
    <script src="game.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .containers {
            position: relative;
            text-align: center;
        }

        .image {
            width: 300px;
            height: auto;
            border-radius: 20px;
            cursor: pointer;
            display: none;
        }

        .loading {
            font-size: 18px;
            color: #555;
        }

        .download-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
        }

        .download-btn i {
            color: #007bff;
            transition: color 0.3s;
        }

        .download-btn i:hover {
            color: #0056b3;
        }

        .popups {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popups-content {
            position: relative;
            text-align: center;
        }

        .popups-image {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 20px;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }


:root {
   /* Dark mode overrides */
      --primary: #7032da    ;
      --primary-hover: #8c4aff; /* Added hover state for dark mode */
      --primary-dark: #669df6;
      --primary-light: #1e3a8a;
      
      --bg-input: #1e203b;
      --shadow-bx:  0 4px 20px rgba(0, 0, 0, 0.26);
  
      --border-radius: 20px;
      --text-primary: #e8eaed;
      --border-input-color: #5f6368;
      --text-secondary: #9aa0a6;
      --bg-primary: #161938;
      --bg-secondary: #171717;
      --border-color: #7a2cff;
      /* Dark mode shadows */
      --shadow-sm: 0 1px 3px 0 rgba(0,0,0,0.5), 0 1px 2px 0 rgba(0,0,0,0.3);
       --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.5), 0 2px 4px -1px rgba(0,0,0,0.3);
   
  }
  
  @media (prefers-color-scheme: dark) {
    :root {
      /* Dark mode overrides */
      --primary: #7032da    ;
      --primary-hover: #8c4aff; /* Added hover state for dark mode */
      --primary-dark: #669df6;
      --primary-light: #1e3a8a;
      
      --bg-input: #1e203b;
      --shadow-bx:  0 4px 20px rgba(0, 0, 0, 0.26);
  
      --border-radius: 20px;
      --text-primary: #e8eaed;
      --border-input-color: #5f6368;
      --text-secondary: #9aa0a6;
      --bg-primary: #161938;
      --bg-secondary: #171717;
      --border-color: #7a2cff;
      /* Dark mode shadows */
      --shadow-sm: 0 1px 3px 0 rgba(0,0,0,0.5), 0 1px 2px 0 rgba(0,0,0,0.3);
       --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.5), 0 2px 4px -1px rgba(0,0,0,0.3);
    }
  }
  
  .fraction {
      display: inline-block;
      vertical-align: middle;
      text-align: center;
    }
    .numerator {
      display: block;
      border-bottom: 1px solid black;
    }
    .denominator {
      display: block;
    }
  
  /* Minimal Gray Line Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  
  ::-webkit-scrollbar-thumb {
    background: rgba(128, 128, 128, 0.4);
    border-radius: 3px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: rgba(128, 128, 128, 0.6);
  }
  
  /* Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: rgba(128, 128, 128, 0.4) transparent;
  }
          
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
  
          body {
              font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
              color: var(--text-primary);
              background-color: var(--bg-primary);
              line-height: 1.5;
              margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-y: auto; /* Makes body scrollable */
    scroll-behavior: smooth; /* Smooth scrolling */
              -webkit-font-smoothing: antialiased;
              -moz-osx-font-smoothing: grayscale;
          }
  
          #app {
              display: flex;
              flex-direction: column;
              min-height: 100vh;
              max-width: 1200px;
              
              margin: 0 auto;
              padding: 0 20px;
          }
  
          header {
              display: flex;
              align-items: center;
              padding: 16px 0;
              border-bottom: 1px solid rgba(0, 0, 0, 0.08);
              margin-bottom: 24px;
          }
  
          .logo {
              display: flex;
              align-items: center;
              gap: 12px;
          }
  
          .logo-icon img {
              width: 40px;
              height: 40px;
              background: none;
              border-radius: 8px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-weight: bold;
              font-size: 28px;
          }
  
          .logo-text {
              font-size: 20px;
              font-weight: 600;
              color: var(--text-primary);
          }
  
          .logo-beta {
    font-size: 1.2em;
    color: white;
    background-color: var(--primary);
    padding: 3px 9px;
    border-radius: 10px;
    margin-left: 8px;
    line-height: 1.2em; /* Match the font-size for equal height */
    display: inline-flex; /* Or inline-block to control image dimensions */
    align-items: center; /* Vertically align the image in the middle */
  }
  
  
  
  
  
  .logo-beta img {
    height: 1.2em; /* Make the image height match the line-height */
    filter: brightness(0) invert(1);
    vertical-align: middle; /* Align the image vertically in the middle of the text */
  }
  
  .underline {
    text-decoration: underline;
    text-decoration-color: var(--primary);
  }
  
          .chat-container {
              flex: 1;
              display: flex;
              
              flex-direction: column;
              background-color: var(--bg-primary);
              border-radius: var(--border-radius);
                overflow: hidden;
                
              margin-bottom: 80px; /* Increased margin to prevent overlap with fixed input area */
          }
  
          .chat-header {
              padding: 16px 24px;
              background-color: var(--bg-primary);
              border-bottom: 1px solid rgba(0, 0, 0, 0.05);
              display: flex;
              align-items: center;
              justify-content: space-between;
          }
  
          .chat-title {
              font-weight: 600;
              color: var(--text-primary);
          }
  
          .chat-actions {
              display: flex;
              gap: 12px;
          }
  
          .chat-action-btn {
              background: none;
              border: none;
              color: var(--text-secondary);
              cursor: pointer;
              font-size: 14px;
              padding: 8px 8px;
              border-radius: 10px;
              transition: var(--transition);
          }
  
          .chat-action-btn:hover {
              background-color: rgba(0, 0, 0, 0.05);
              color: var(--text-primary);
          }
  
          .messages-container {
              flex: 1;
              padding: 16px 24px;
            
              overflow-y: auto;
              scroll-behavior: smooth;
          }

          /* User message bubble */
.message-user {
  display: flex;
  justify-content: flex-end; /* Align to the right */
  margin: 10px 0;
}

.message-user .message-content {
  max-width: 70%;
  background-color: var(--primary-hover);
  color: white;
  padding: 12px 16px;
  border-radius: 20px 20px 0 20px; /* Rounded corners */
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}

/* Bot message bubble */
.message-bot {
  display: flex;
  justify-content: flex-start; /* Align to the left */
  margin:  0;
}

.message-bot .message-content {
  max-width: 70%;
 
  color: var(--text-primary);
  padding: 12px 16px;
  border-radius: 20px 20px 20px 0; /* Rounded corners */

  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}

/* Avatar alignment */
.message-user .message-avatar {
  margin-left: 10px;
}

.message-bot .message-avatar {
  margin-right: 10px;
}


  
          .message {
              display: flex;
              gap: 1px;
              padding: 12px 0;
              opacity: 0;
              transform: translateY(10px);
              animation: messageAppear 0.3s forwards;
          }
  
          @keyframes messageAppear {
              to {
                  opacity: 1;
                  transform: translateY(0);
              }
          }
  
          .message-avatar {
      width: 36px;
    height: 36px;
    /* Only show border for bot avatar */
    border: 2px solid transparent;
    }
    .message-bot .message-avatar {
        border: 2px solid var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-weight: bold;
      flex-shrink: 0;
      overflow: hidden; /* Crucial for images */
  }

  /* For Font Awesome icons */
  .message-avatar i {
      font-size: 16px; /* Matches your compact design */
      color: var(--text-primary);
      
  }

  /* For image avatars */
  .message-avatar img {
      width: 80%;
      height: 80%;
      background-color: none;
      object-fit: cover; /* Prevents distortion */
      object-position: center; /* Centers focal point */
      border: none;
  }

          .message-bot .message-avatar {
              filter: brightness(2000%);
              border: 2px solid var(--primary); /* White border for bot avatar */
              color: var(--text-secondary);
          }
  
          .message-content {
              flex: 1;
          }
  
          .message-header {
              display: flex;
              align-items: center;
              gap: 8px;
              margin-bottom: 4px;
          }
  
          .message-sender {
              font-weight: 600;
              font-size: 15px;
          }
  
          .message-time {
              font-size: 12px;
              color: var(--text-secondary);
          }
  
          .message-text {
              font-size: 15px;
              line-height: 1.6;
              word-wrap: break-word;
              white-space: pre-wrap;
          }
  
          .message-text p {
              margin-bottom: 8px;
          }
  
          .message-text p:last-child {
              margin-bottom: 0;
          }
  
          .message-text strong {
              font-weight: 600;
          }
  
          .message-text em {
              font-style: italic;
          }
  
  
  
          .message-text pre {
              background-color: rgba(0, 0, 0, 0.05);
              padding: 12px;
              border-radius: 6px;
              overflow-x: auto;
              margin: 8px 0;
          }
  
          .input-container {
    padding: 16px 24px;
    background-color: var(--bg-input);
    border-radius: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  
  /* Mobile (default) - fixed at bottom */
  .input-container {
    position: fixed;
    bottom: 0;
    left: 0;
    background-color: var(--bg-input);
    right: 0;
    margin: 0 auto;
    border-color: var(--border-input-color);
    width: 100%;
    border-radius: 30px 30px 0px  0px ;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    max-width: 100%;
    
  }
  
  /* PC - centered and wider popup */
  @media (min-width: 768px) {
    .input-container {
      position: fixed;
      bottom: 40px;
      background-color: var(--bg-input);
      left: 50%;
      transform: translateX(-50%) scale(0.98);
      width: 80%;
      border-radius: 30px ;
      max-width: 800px;
      min-width: 500px;
      box-shadow: var(--shadow-bx);
   transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      z-index: 1000;
    }
  
    /* Expanded state when textarea is focused */
    .input-container:has(.input-textarea:focus) {
      width: 90%;
      background-color: var(--bg-input);
      max-width: 1000px;
     box-shadow: var(--shadow-bx);
      transform: translateX(-50%) scale(1);
      
        }
  }
  
  .input-box {
    position: relative;
    display: flex;
    align-items: flex-end;
    gap: 12px;
    background-color: var(--bg-input);
    transition: all 0.3s ease;
  }
  
  .input-textarea {
    flex: 1;
    min-height: 60px;
    max-height: 200px;
    padding: 12px 16px;
    border: none;
    color: var(--text-primary);
    background-color: var(--bg-input); 
    border-radius: var(--border-radius);
    font-family: inherit;
    font-size: 15px;
    resize: none;
    outline: none;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  
  
  
  .input-action-btn {
    /* Layout */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Space between icon and text */
    
    /* Dimensions */
    min-width: 50px;
    height: 40px;
    padding: 0 12px;
    border-radius: 50px; /* Fully rounded ends */
    
    /* Appearance */
    background: none;
    border: 1px solid gray;
    color: var(--text-secondary);
    cursor: pointer;
    
    /* Typography */
    font-family: inherit;
    font-size: 14px;
    font-weight: 500;
    margin-right: 10px;
    line-height: 1;
    
    /* Icon styling */
    .icon {
      font-size: 18px;
      font-weight: bold;
      display: flex;
      align-items: center;
    }
    
    /* Transition */
    transition: var(--transition);
  }
  
  .input-action-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
    color: var(--primary);
    border-color: var(--primary);
  }
  
  /* Specific DL button style */
  .input-action-btn.dl-btn {
    .icon {
      font-weight: 800; /* Extra bold for DL */
      letter-spacing: -0.5px;
    }
  }
  
  .send-btn {
    background-color: var(--primary);
    color: white;
    font-size: 17px;
    text-align: center;
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    
  }
  
  .send-btn:hover {
      background-color: var(--primary-hover);
    
  }
  
  /* Disabled button styling */
  .send-btn:disabled {
    background-color: #dbc6ff;
    cursor: not-allowed;
  }
  
  
  
          /* Animation for when input gains focus */
  @keyframes inputExpand {
    from {
      width: 80%;
      max-width: 800px;
    }
    to {
      width: 90%;
      max-width: 1000px;
    }
  }
  
  /* Animation for when input loses focus */
  @keyframes inputContract {
    from {
      width: 90%;
      max-width: 1000px;
    }
    to {
      width: 80%;
      max-width: 800px;
    }
  }
  
          .typing-indicator {
              display: flex;
              gap: 6px;
              padding: 12px 0;
          }
  
          .typing-dot {
              width: 8px;
              height: 8px;
              background-color: var(--text-secondary);
              border-radius: 50%;
              opacity: 0.4;
              animation: typingAnimation 1.4s infinite ease-in-out;
          }
  
          .typing-dot:nth-child(1) {
              animation-delay: 0s;
          }
  
          .typing-dot:nth-child(2) {
              animation-delay: 0.2s;
          }
  
          .typing-dot:nth-child(3) {
              animation-delay: 0.4s;
          }
  
          @keyframes typingAnimation {
              0%, 60%, 100% {
                  transform: translateY(0);
                  opacity: 0.4;
              }
              30% {
                  transform: translateY(-5px);
                  opacity: 1;
              }
          }
  
          .status-bar {
              display: flex;
              justify-content: space-between;
              padding: 8px 24px;
              font-size: 12px;
              color: var(--text-secondary);
              border-top: 1px solid rgba(0, 0, 0, 0.05);
              margin-bottom: 80px;
              
               /* add margin-bottom to status bar */
          }
  
          .model-info {
              display: flex;
              align-items: center;
              gap: 6px;
          }
  
          .model-tag {
              background-color: rgba(66, 133, 244, 0.1);
              color: var(--primary);
              padding: 2px 6px;
              border-radius: 4px;
              font-weight: 500;
          }
  
          @media (max-width: 768px) {
              .chat-header, .messages-container, .input-container {
                  padding-left: 16px;
                  padding-right: 16px;
              }
              
              .input-box {
                  gap: 8px;
              }
              
              .send-btn {
                  width: 42px;
                  height: 42px;
              }
              
               .input-container {
                  padding: 12px 16px; /* Adjust padding for smaller screens */
              }
          }
  
          /* Dark mode toggle styles */
          .dark-mode-toggle {
              position: fixed;
              bottom: 150px; /* adjust as needed */
              right: 20px;
              width: 48px;
              height: 48px;
              border-radius: 50%;
              background-color: var(--bg-primary);
              box-shadow: var(--shadow-md);
              display: flex;
              align-items: center;
              justify-content: center;
              cursor: pointer;
              z-index: 100;
              border: none;
              color: var(--text-primary);
              transition: var(--transition);
          }
          
          .dark-mode-toggle:hover {
               background-color: rgba(0, 0, 0, 0.05);
          }
  
  
          
          /* Popup Styles */
          .popup {
              display: none;
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background-color: var(--bg-primary);
              padding: 24px;
              border-radius: var(--border-radius);
              box-shadow: var(--shadow-md);
              z-index: 1000;
              width: 90%;
              max-width: 400px;
          }
  
          .popup.show {
              display: block;
          }
  
          .popup-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 16px;
              border-bottom: 1px solid rgba(0, 0, 0, 0.05);
              padding-bottom: 8px;
          }
  
          .popup-title {
              font-size: 18px;
              font-weight: 600;
              color: var(--text-primary);
          }
  
          .popup-close {
              background: none;
              border: none;
              color: var(--text-secondary);
              cursor: pointer;
              font-size: 20px;
              padding: 0;
              transition: var(--transition);
          }
  
          .popup-close:hover {
              color: var(--text-primary);
          }
  
          .popup-body {
              margin-bottom: 24px;
          }
  
          .popup-input-group {
              display: flex;
              flex-direction: column;
              margin-bottom: 16px;
          }
  
          .popup-input-group label {
              font-size: 14px;
              color: var(--text-secondary);
              margin-bottom: 6px;
          }
  
          .popup-input-group input, .popup-input-group textarea {
              padding: 10px;
              border-color: var(--border-color);
              border-radius: var(--border-radius);
              font-family: inherit;
              font-size: 15px;
              background-color: var(--bg-primary);
              color: var(--text-primary);
              outline: none;
              transition: var(--transition);
          }
  
          .popup-input-group input:focus, .popup-input-group textarea:focus {
              border-color: var(--primary);
              box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
          }
          
          .popup-input-group textarea {
              min-height: 300px;
              resize: vertical;
          }
  
          .popup-actions {
              display: flex;
              justify-content: flex-end;
              gap: 12px;
          }
  
          .popup-button {
              padding: 10px 16px;
              border: none;
              border-radius: var(--border-radius);
              font-size: 15px;
              font-weight: 500;
              cursor: pointer;
              transition: var(--transition);
          }
  
          .popup-button.primary {
              background-color: var(--primary);
              color: white;
          }
  
          .popup-button.primary:hover {
              background-color: var(--primary-hover);
          }
  
          .popup-button.secondary {
              background-color: var(--bg-secondary);
              color: var(--text-primary);
          }
  
          .popup-button.secondary:hover {
              background-color: rgba(0, 0, 0, 0.05);
          }
          
          #attachment-description {
              margin-top: 8px;
              font-size: 12px;
              color: var(--text-secondary);
          }
  
  
          
         
  
          .frac {
    display: inline-block;
    position: relative;
    vertical-align: middle;
    text-align: center;
    margin: 0 0.2em;
  }
  
  .frac > sup, 
  .frac > sub {
    display: block;
    font-size: 1.2em;
    line-height: 1.2;
    padding: 0 0.3em; /* Add horizontal padding */
  }
  
  .frac > sup {
    border-bottom: 1px solid currentColor; /* Horizontal line only */
  }
  
  .frac > sub {
    padding-top: 0.1em;
  }
  
  /* Add these styles to your existing CSS */
  .message-attachment {
      background-color: var(--bg-input); 
    border-radius: var(--border-radius);
      padding: 12px;
      margin: 10px 0;
  color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 12px;
      width:  40%;
      box-sizing: border-box;
  }
  
  .file-icon {
      font-size: 28px;
      color: var(--text-primary);
      flex-shrink: 0;
  }
  
  
  
      .foldery {
        width: 40px;
        height: 40px;
        object-fit: contain;
        margin-right: 15px; /* Space between the image and text */
      }
  
  
  .file-info {
      flex-grow: 1;
  }
  
  .file-name {
      font-weight: bold;
      word-break: break-all;
      color: var(--text-primary);
  }
  
  .attachment-description {
      color: #ffffff;
      font-size: 15px;
              line-height: 1.6;
      margin-top: 8px;
      padding-left: 40px;
      word-break: break-word;
  }
  
  /* Color coding for different file types */
  .fa-file-word { color: #2b579a; } /* Word blue */
  .fa-file-excel { color: #217346; } /* Excel green */
  .fa-file-powerpoint { color: #d24726; } /* PowerPoint orange */
  .fa-file-pdf { color: #e74c3c; } /* PDF red */
  .fa-file-image { color: #e67e22; } /* Image orange */
  .fa-file-audio { color: #9b59b6; } /* Audio purple */
  .fa-file-video { color: #3498db; } /* Video blue */
  
  
  /* Modern bullet point styling */
  .ai-list {
      padding-left: 1.5em;
      margin: 0.8em 0;
      list-style: none;
  }
  
  .ai-bullet {
      position: relative;
      padding-left: 1em;
      margin-bottom: 0.5em;
      line-height: 1.5;
  }
  
  .ai-bullet::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0.4em;
      width: 0.5em;
      height: 0.5em;
      background-color: #4a6bdf;
      border-radius: 50%;
      transform: translateX(-150%);
  }
  
  /* Animation for bullet points */
  .ai-list li {
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
  }
  
  @keyframes fadeIn {
      to {
          opacity: 1;
      }
  }


  
  
  /* Stagger the animation */
  .ai-list li:nth-child(1) { animation-delay: 0.1s; }
  .ai-list li:nth-child(2) { animation-delay: 0.2s; }
  .ai-list li:nth-child(3) { animation-delay: 0.3s; }
  /* Add more as needed */
  
/* Responsive adjustments for markdown table */
@media (max-width: 720px) {
  .markdown-table-container {
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    max-width: 100%; /* Ensure it fits within the screen width */
    overflow-x: auto; /* Add horizontal scrolling if the table exceeds the screen width */
    border-radius: calc(var(--table-radius) * 0.75);
    margin: 1.25rem 0;
    box-shadow: var(--shadow-sm);
  }

  .markdown-table {
    min-width: 450px; /* Minimum width for proper layout */
    font-size: 0.875rem;
  }

  .markdown-table th,
  .markdown-table td {
    padding: 0.875rem 1.125rem;
  }
}
  
  .markdown-table-container {
  --table-header-bg: var(--primary);
  --table-header-text: white;
  --table-border: var(--border-color);
  --table-row-even: color-mix(in srgb, var(--bg-secondary) 90%, transparent);
  --table-row-hover: color-mix(in srgb, var(--primary) 12%, transparent);
  --table-radius: var(--border-radius);
  
  overflow-x: auto; /* Enable horizontal scrolling */
    max-width: 100%; /* Ensure it doesn't exceed the container width */
    margin: 1.75rem 0;
    box-shadow: var(--shadow-md);
    border-radius: var(--table-radius);
    border: 1px solid var(--table-border);
    background-color: var(--bg-primary);
    transition: var(--transition);
}

.markdown-table {
    width: 100%; /* Ensure the table takes full width */
    min-width: 600px; /* Minimum width for proper layout */
    border-collapse: separate;
    border-spacing: 0;
    font-size: 0.9375rem;
    line-height: 1.6;
    color: var(--text-primary);
    background-color: var(--bg-primary);
    text-align: left;
    table-layout: auto; /* Allow cells to adjust to content */

}


/* Header styles */
.markdown-table thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

.markdown-table thead tr {
  background-color: var(--table-header-bg);
  color: var(--table-header-text);
  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
}
a {
    color: var(--primary);
    text-decoration: none; /* Optional: Removes underline */
}

a:hover {
    color: var(--primary-hover); /* Optional: Changes color on hover */
    text-decoration: underline; /* Optional: Adds underline on hover */
}
.markdown-table th {
  padding: 1.125rem 1.5rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: none;
  word-wrap: break-word; /* Break long words */
    overflow-wrap: break-word; /* Break long words */
    white-space: normal; /* Allow text wrapping */

  border-bottom: 2px solid color-mix(in srgb, var(--primary) 80%, black);
}

/* Cell styles */
.markdown-table td {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--table-border);
  vertical-align: middle;
  word-wrap: break-word; /* Break long words */
    overflow-wrap: break-word; /* Break long words */
    white-space: normal; /* Allow text wrapping */

  transition: background-color 0.15s ease;
}

/* Column alignment options */
.markdown-table .text-center {
  text-align: center;
}

.markdown-table .text-right {
  text-align: right;
}

/* Zebra striping with subtle transparency */
.markdown-table tbody tr:nth-child(even) {
  background-color: var(--table-row-even);
}

/* Enhanced hover effect */
.markdown-table tbody tr:hover {
  background-color: var(--table-row-hover);
  transform: translateX(2px);
  box-shadow: 2px 0 0 0 var(--primary) inset;
}

/* Rounded corners */
.markdown-table tr:first-child th:first-child {
  border-top-left-radius: var(--table-radius);
}

.markdown-table tr:first-child th:last-child {
  border-top-right-radius: var(--table-radius);
}

.markdown-table tr:last-child td:first-child {
  border-bottom-left-radius: var(--table-radius);
}

.markdown-table tr:last-child td:last-child {
  border-bottom-right-radius: var(--table-radius);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .markdown-table-container {
    border-radius: calc(var(--table-radius) * 0.75);
    margin: 1.25rem 0;
    box-shadow: var(--shadow-sm);
  }
  
  .markdown-table {
    min-width: 450px;
    font-size: 0.875rem;
  }
  
  .markdown-table th,
  .markdown-table td {
    padding: 0.875rem 1.125rem;
  }
}

/* Animation enhancements */
@keyframes tableRowEnter {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.markdown-table tbody tr {
  animation: tableRowEnter 0.3s ease forwards;
}

.markdown-table tbody tr:nth-child(1) { animation-delay: 0.05s; }
.markdown-table tbody tr:nth-child(2) { animation-delay: 0.1s; }
.markdown-table tbody tr:nth-child(3) { animation-delay: 0.15s; }
/* ... and so on ... */
  
  /* Code blocks */
  .code-block, .html-source {
    position: relative;
    background: var(--code-bg);
    border-radius: 6px;
    padding: 1em;
    overflow-x: auto;
    margin: 1em 0;
    border: 1px solid #ddd;
  }
  
  .code-block code, .html-source code {
    display: block;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 0.9em;
    color: var(--code-text);
    white-space: pre;
  }
  
  .inline-code {
    background: var(--inline-code-bg);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.9em;
    color: var(--inline-code-text);
  }
  
  
  
  /* Copy button */
  .copy-button {
    position: absolute;
    top: 0.5em;
    right: 0.5em;
    background: var(--copy-btn-bg);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 0.3em 0.6em;
    font-size: 0.8em;
    cursor: pointer;
    transition: all 0.2s;
    opacity: 0.8;
  }
  
  .copy-button:hover {
    background: var(--copy-btn-hover);
    opacity: 1;
  }
  
  #search.active {
      background-color: var(--primary);
      color: white;
  }
  
  .quote {
              position: relative;
              display: inline-block;
              border-left: 4px solid var(--primary);
              padding: 8px 30px 8px 12px; /* Right padding for icon */
              margin: 6px 0;
              border-radius: 15px;
              background: rgba(192, 192, 192, 0.164);
              font-style: normal;
          }
  
          .quote::after {
              content: "\f10e"; /* Font Awesome quote-right icon */
              font-family: "Font Awesome 6 Free";
              font-weight: 900;
              position: absolute;
              top: 8px;
              right: 8px;
              color: var(--primary);
              opacity: 0.5;
              font-size: 1.2em;
          }
  
  
  
  
          .quiz-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }
  
      .question-card {
        background: var(--bg-secondary);
        border-radius: 20px;
        padding: 20px;
        color: var(--text-primary);
        margin-bottom: 20px;
        position: relative; /* Needed for absolute positioning of footer */
   padding-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #f39c12;
      }
  
  
  
  .card-footer {
    position: absolute;
    right: 20px;
    bottom: 10px;
  
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .footer-text {
    font-size: 1.2rem;
    color: var(--text-secondary)
  }
  
  .footer-logo {
    height: 40px; /* Same height as text */
    width: auto; /* Maintain aspect ratio */
    filter: brightness(0) invert(1);
    opacity: 0.7;
  }
  
      .question-text {
        font-size: 1.1rem;
        margin-bottom: 0.2rem;
        color: var(--text-primary);
        font-weight: 600;
      }
  
      .choices {
        display: flex;
        flex-direction: column;
        color: var(--text-primary);
        gap: 10px;
        
      }
  
      .choice-card {
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 15px;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
      }
  
      .choice-card:hover {
        background-color: var(--bg-input);
      }
  
      .choice-card.selected {
        border-color: #f39c12;
   
      }
  
      .choice-card.correct {
        border-color: #28a745;
  
        transform:  scale(1.01);
        
      }
  
      .choice-card.incorrect {
    border-color: #dc3545;
    
    transform: scale(0.99);
    transform-style: preserve-3d;
    animation: shake 0.5s;
    /* Added animation */
  }
  
  @keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
  }
  
  .html-preview {
      background-color: transparent;
      margin: 0;
      border-color: green;
  }
  
  .shake {
      animation: shake 1s;
      transform: scale(1.01);
      transform-style: preserve-3d;
      color: var(--text-primary)
  }
  @keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
  }
  
  .welcome {
      text-align: center;
  position: fixed;
  left: 0;
  right: 0;
  bottom: 45%;
      font-size: 28px;
    
  }
  
  .welcomeimg {
      
      height: 10em; 
      position: fixed;
    bottom: 50%;
    left: 0;
    
    right: 0;
    margin: 0 auto;   
  }
  /* Add to your CSS */
.message-actions {
    display: flex;
    gap: 10px;
    margin-top: 8px;
    margin-bottom: 2px;
    align-items: center;
}
.msg-action-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.1em;
    cursor: pointer;
    transition: color 0.2s;
    padding: 4px 8px;
    border-radius: 6px;
}
.msg-action-btn:hover, .msg-action-btn:focus {
    color: var(--primary);
    background: rgba(127,127,255,0.07);
}
.msg-action-btn .fa-solid {
    color: var(--primary);
}
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="logo">
                <div class="logo-icon"><img src="lt-ai.png"></img></div>
                <div class="logo-text">LT AI 
            </div>
        </header>

        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">New conversation</div>
                <div class="chat-actions">
                    <button class="chat-action-btn" id="clear-button" title="Clear conversation">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="chat-action-btn" id="settings-button" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

           
            <div class="messages-container" id="messages-container">

            </div>
            

            <div class="input-container">
                <div class="input-box">
                    <textarea class="input-textarea" id="user-input" placeholder="Message LT AI..." rows="1"></textarea>
                    <button class="send-btn" id="send-button">
                        <i class= "fa-solid fa-arrow-up"></i>
                        <i style="display: none;" class="fa-solid fa-arrow-up"></i>
                    </button>
                </div>
                <div class="input-actions">
                    <button class="input-action-btn" id="attach-button" title="Attach file">
                        <i class="fas fa-paperclip"></i> Attach
                    </button>
                    <button class="input-action-btn" id="search" itle="Attach file">
                        <i class="fas fa-search"></i>Search
                    </button>

                </div>
                
            </div>

            <div class="status-bar">
                <div class="model-info">
                   
                     </div>
             
            </div>


   
    
    <div class="popup" id="settings-popup">
        <div class="popup-header">
            <h2 class="popup-title">Settings</h2>
            <button class="popup-close" id="settings-close">&times;</button>
        </div>
        <div class="popup-body">
            <div class="popup-input-group">
                <label for="api-token">API Token</label>
                <input type="text" id="api-token" placeholder="Enter your API token">
            </div>
            <div class="popup-input-group">
                <label for="system-instructions">System Instructions</label>
                <textarea id="system-instructions" placeholder="Enter system instructions..."></textarea>
            </div>
        </div>
        <div class="popup-actions">
            <button class="popup-button secondary" id="settings-cancel">Cancel</button>
            <button class="popup-button primary" id="settings-save">Save</button>
        </div>
        
    </div>
    
    <div class="popup" id="attachment-popup">
        <div class="popup-header">
            <h2 class="popup-title">Attach File</h2>
            <button class="popup-close" id="attachment-close">&times;</button>
        </div>
        <div class="popup-body">
            <div class="popup-input-group">
                <label for="file-input" class="custom-file-upload">
                    <i class="fas fa-upload"></i> Choose File
                </label>
                <input type="file" id="file-input" accept=".txt,.md,.json,.docx,.ppt,.xls,.xlsx,.pdf,.png,.jpg,.jpeg">
                <p id="attachment-description"></p>
            </div>
            <div class="popup-input-group">
                <label for="file-description">File Description (Optional)</label>
                <textarea id="file-description" placeholder="Enter a description for the file..."></textarea>
            </div>
        </div>
        <div class="popup-actions">
            <button class="popup-button secondary" id="attachment-cancel">Cancel</button>
            <button class="popup-button primary" id="attachment-send">Send</button>
        </div>
    </div>

    

    <script>
   // Configuration
const DEFAULT_MODEL_NAME = "gemini-2.0-flash";
let API_KEY = localStorage.getItem('apiKey') || "";
let MODEL_NAME = localStorage.getItem('modelName') || DEFAULT_MODEL_NAME;
let SYSTEM_INSTRUCTIONS_TEXT = localStorage.getItem('systemInstructions') || `
You are , your idenity, Your name: LT AI * be friendly * use emojis   BEFORE RESPONDING CHECHK ALL THESE RULES.!!!  give detailed answers for users , use headings and explin more  1. #pro# Text Use: Highlight important words, answers, or warnings.  Example:  #pro#Important: Save your file.#pro#  Answer:#pro# 10#pro#  * use #un# underlined text #un# to send underlined text . (sometimes replace the #pro# with this if pro isint needed.) (to let u understand why are there sed (t know when to use, the #pro# will make the text be highlited, the un will underline.) * use #qu# text #qu# for quotes, same as #pro# it works, and it shoq quote effect, replece ur quote effects with this ALWAYS not in just quotes, it only supports only line at a time, so remember this.  2. maths use mathsJax . (using $ or $$) ,   3. Code u dont code.  4. Web Searches Use search only when necessary, such as:   Start with: "According to [source]..." use [Site name](url) instead of links  5. Lists Always use: • Item 1 • Item 2 • Item 3  6. When:  User mentions any app name (e.g., "Google", "Telegram")  OR asks about an app (e.g., "How to use WhatsApp?")  Action:  Start the response with: #pro#<i class="fab fa-APPNAME"></i>#pro# (Replace "APPNAME" with the lowercase app name, e.g., fa-google, fa-whatsapp)  Examples:  User says: "What's Facebook?" → AI starts with: #pro#<i class="fab fa-facebook"></i>#pro#  User asks: "How to login to Telegram?" → AI starts with: #pro#<i class="fab fa-telegram"></i>#pro#  Note:  Works for all major apps (Google, Facebook, WhatsApp, Telegram, etc.). (also, dont frget to show that lightbulb i meanioned onnumber 8 if the user ask "how to")  If the app isn't in Font Awesome, use a generic file icon: #pro#<i class="fas fa-file"></i>#pro#  7. Files When a file is mentioned: Add #pro#<i class="fa-solid fa-paperclip"></i>#pro#  8. Tech Help ("How To") Start with: #pro#<i class="fas fa-lightbulb"></i>#pro#  Use app logos:  Example: "Telegram" → <i class="fab fa-telegram"></i>  9. Math Symbols Replace symbols: with mathjax (all.!) with $ or $$ (you know the mathjax how it wokrs)  * and other when showing steps on maths (1,... 2,...) make the heading heading. u decide the size.  10. When User Says "Thanks" OR any related to that if thanked: add <span class="logo-beta"><i class="fas fa-heart"></i></span> on top of your message that u plan to reponse  10. Use Markdown headings (#, ##, ###, etc.) to structure multi-part answers. Vary the number of '#' to indicate heading level and importance for clear readability.  11. use #!   !# for bolding texts, place the boled text inside the hash and !, dont forgt to close after opeing   12, use this method to generete images, just send this , https://botfather.cloud/Apis/ImgGen/?prompt=userpromt.png  13, headings, # Heading text - for h1 ## Heading text - for h2 ### Heading text - for h3  make sure there is space bn the text and hash `;

// Search configuration
const SEARCH_API_KEY = "AIzaSyA_pN9LAbMQIidtXXVOl0RhBRP3sTiKEok";
const SEARCH_ENGINE_ID = "606ccc9ed0a4c423d";
let searchEnabled = false;

// System instructions to shape AI behavior
let SYSTEM_INSTRUCTIONS = {
    role: "user",
    parts: [{
        text: SYSTEM_INSTRUCTIONS_TEXT
    }]
};

// Conversation history
let conversationHistory = [
    SYSTEM_INSTRUCTIONS,
    {
        role: "model",
        parts: [{ text: "Understood! I'm Gemini 2.0 Pro, ready to assist you with professional, accurate, and helpful responses." }]
    }
];

// DOM elements
const messagesContainer = document.getElementById('messages-container');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const searchButton = document.getElementById('search');
const settingsButton = document.getElementById('settings-button');
const settingsPopup = document.getElementById('settings-popup');
const settingsClose = document.getElementById('settings-close');
const settingsCancel = document.getElementById('settings-cancel');
const settingsSave = document.getElementById('settings-save');
const apiTokenInput = document.getElementById('api-token');
const systemInstructionsInput = document.getElementById('system-instructions');
const clearButton = document.getElementById('clear-button');
const attachmentButton = document.getElementById('attach-button');
const attachmentPopup = document.getElementById('attachment-popup');
const attachmentClose = document.getElementById('attachment-close');
const attachmentCancel = document.getElementById('attachment-cancel');
const attachmentSend = document.getElementById('attachment-send');
const fileInput = document.getElementById('file-input');
const fileDescriptionInput = document.getElementById('file-description');
const attachmentDescriptionLabel = document.getElementById('attachment-description');
const nextButton = document.getElementById('next-button');

let attachedFile = null;

// Initialize app
function initApp() {
    // Display welcome message
    displayMessage({
        text: "Hello! I'm LT AI. How can I assist you today?",
        sender: 'bot',
        isWelcome: true
    });
    
    // Auto-resize textarea
    setupTextareaAutoResize();
    
    // Focus input
    userInput.focus();
    
    // Load saved settings
    apiTokenInput.value = API_KEY;
    systemInstructionsInput.value = SYSTEM_INSTRUCTIONS_TEXT;
    
    // Set up search button
    searchButton.addEventListener('click', toggleSearch);
}

// Toggle search functionality
function toggleSearch() {
    searchEnabled = !searchEnabled;
    searchButton.classList.toggle('active', searchEnabled);
   
}

// Main function to handle messages
async function sendMessage(customMessage = null) {
    // If a file is attached, do not display the description as the main message text
    const isFile = !!attachedFile;
    const message = isFile ? "" : (customMessage || userInput.value.trim());
    if (!message && !attachedFile) return;

    // Display user message
    displayMessage({
        text: message,
        sender: "user",
        attachment: attachedFile ? {
            file: attachedFile,
            description: fileDescriptionInput.value
        } : null
    });

    // Prepare message content
    let messageContent = [];
    if (message) {
        messageContent.push({ text: message });
    }

    if (attachedFile) {
        try {
            const fileContents = await readFileAsText(attachedFile);
            const fileType = getFileType(attachedFile.name);
            
            messageContent.push({
                text: `[FILE ATTACHMENT: ${attachedFile.name} (${fileType})]\n` +
                      `FILE CONTENTS:\n"${fileContents}"\n` +
                      `[END OF FILE ATTACHMENT]` +
                      (fileDescriptionInput.value ? `\nUSER DESCRIPTION: ${fileDescriptionInput.value}` : "")
            });
        } catch (error) {
            console.error("Error reading file:", error);
            messageContent.push({
                text: `[Failed to read attached file: ${attachedFile.name}]`
            });
        }
    }

    // Clear input and reset state
    userInput.value = "";
    userInput.style.height = "60px"; // Reset the height of the textarea
    userInput.disabled = true;
    sendButton.disabled = true;
    attachedFile = null;
    fileDescriptionInput.value = "";
    attachmentDescriptionLabel.textContent = "";
    attachmentPopup.classList.remove("show");

    try {
        // Show loading indicator
        const loadingId = showLoadingIndicator();

        let currentHistory = [...conversationHistory];
        
        if (searchEnabled && message && !attachedFile) {
            // Perform web search first
            const searchResults = await performWebSearch(message);
            const searchContext = formatSearchResults(searchResults);
            
            // Create search-enhanced message
            const searchMessage = {
                role: "user",
                parts: [{
                    text: `${message}\n\nWEB SEARCH RESULTS:\n${searchContext}\n\n` +
                          `INSTRUCTIONS: Use the above web results to answer the question. ` +
                          `Include relevant links when using information from these results.`
                }]
            };
            
            currentHistory = [
                SYSTEM_INSTRUCTIONS,
                ...conversationHistory.slice(1),
                searchMessage
            ];
        } else {
            // Add normal message to history
            currentHistory = [
                ...conversationHistory,
                {
                    role: "user",
                    parts: messageContent
                }
            ];
        }

        // Call Gemini API
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`,
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: currentHistory,
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 2000,
                        topP: 0.9,
                        topK: 40,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_ONLY_HIGH",
                        },
                    ],
                }),
            }
        );

        const data = await response.json();
        removeLoadingIndicator(loadingId);

        if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
            let botResponse = data.candidates[0].content.parts[0].text;
            
            // Add indicator if search was used
if (searchEnabled && message && !attachedFile) {
    // Add the Google indicator at the BEGINNING of the response
    botResponse = `#pro#<i class="fab fa-google"></i> #pro#\n\n${botResponse}`;
    
}
            
            displayMessage({
                text: botResponse,
                sender: "bot",
            });

            // Update conversation history
            conversationHistory = [
                ...currentHistory,
                {
                    role: "model",
                    parts: [{ text: botResponse }],
                }
            ];
        } else {
            throw new Error("Unexpected API response structure");
        }
    } catch (error) {
        console.error("API Error:", error);
        removeLoadingIndicator(loadingId);
        displayMessage({
            text: "🔧 Sorry, I encountered an error processing your request. Please try again.",
            sender: "bot",
            isError: true,
        });
    } finally {
        userInput.disabled = false;
        sendButton.disabled = false;
        userInput.focus();
    }
}

async function performWebSearch(query) {
    const apiUrl = `https://www.googleapis.com/customsearch/v1?key=${SEARCH_API_KEY}&cx=${SEARCH_ENGINE_ID}&q=${encodeURIComponent(query)}`;
    const response = await fetch(apiUrl);
    if (!response.ok) {
        throw new Error(`Search API error: ${response.status}`);
    }
    return await response.json();
}

function formatSearchResults(searchData) {
    if (!searchData.items || searchData.items.length === 0) {
        return "No relevant web results found.";
    }
    
    let formattedResults = "";
    for (let i = 0; i < Math.min(3, searchData.items.length); i++) {
        const item = searchData.items[i];
        formattedResults += `• ${item.title}\n  ${item.link}\n  ${item.snippet}\n\n`;
    }
    
    return formattedResults;
}

async function readFileAsText(file) {
    return new Promise(async (resolve, reject) => {
        const extension = file.name.split('.').pop().toLowerCase();

        try {
            // Handle Word documents (.docx)
            if (extension === 'docx') {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                resolve(result.value);
            }
            // Handle Excel files (.xlsx, .xls)
            else if (extension === 'xlsx' || extension === 'xls') {
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer);
                let text = '';

                workbook.SheetNames.forEach(sheetName => {
                    const worksheet = workbook.Sheets[sheetName];
                    text += XLSX.utils.sheet_to_csv(worksheet) + '\n\n';
                });
                resolve(text);
            }
            // Handle PDFs using pdf.js
            else if (extension === 'pdf') {
                const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ') + '\n';
                }
                resolve(text);
            }
            // Handle images using Tesseract.js
            else if (
                extension === 'png' ||
                extension === 'jpg' ||
                extension === 'jpeg' ||
                file.type.startsWith('image/')
            ) {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const { data: { text } } = await Tesseract.recognize(
                            e.target.result,
                            'eng',
                            { logger: m => {/* Optionally log progress */} }
                        );
                        resolve(text.trim());
                    } catch (err) {
                        resolve('[Image text extraction failed]');
                    }
                };
                reader.onerror = (e) => reject(e);
                reader.readAsDataURL(file);
            }
            // Handle text-based files
            else if (file.type.match('text.*') ||
                extension === 'txt' ||
                extension === 'csv' ||
                extension === 'json' ||
                extension === 'md') {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsText(file);
            }
            // Fallback for other files
            else {
                resolve(`[${getFileType(file.name)} file - Please describe the contents.]`);
            }
        } catch (error) {
            console.error("Error reading file:", error);
            reject(`Error processing ${file.name}: ${error.message}`);
        }
    });
}

fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        attachedFile = file;
        attachmentDescriptionLabel.textContent = `Selected File: ${file.name}`;
        // No need to extract image text here, extraction is handled in sendMessage
    } else {
        attachedFile = null;
        attachmentDescriptionLabel.textContent = '';
        fileDescriptionInput.value = '';
    }
});

attachmentSend.addEventListener('click', () => {
    if (attachedFile) {
        sendMessage(fileDescriptionInput.value.trim());
    } else {
        alert('Please select a file to send.');
    }
});

function displayMessage({ text, sender, isWelcome = false, isError = false, attachment = null }) {
    // Generate a unique ID for the message
    const messageId = `${sender}-${text.hashCode()}`;

    

    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', `message-${sender}`);
    messageDiv.id = messageId; // Set the unique ID

    const avatarDiv = document.createElement('div');
    avatarDiv.classList.add('message-avatar');
    avatarDiv.innerHTML = sender === 'user'
        ? ''
        : '<img src="lt-ai.png" alt="AI" onerror="this.style.display=\'none\'">';

    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');

    const headerDiv = document.createElement('div');
    headerDiv.classList.add('message-header');

    const senderDiv = document.createElement('div');
    senderDiv.classList.add('message-sender');
    senderDiv.textContent = sender === 'user' ? 'You' : 'Lt AI';

    const timeDiv = document.createElement('div');
    timeDiv.classList.add('message-time');
    timeDiv.textContent = formatTime(new Date());

    const textDiv = document.createElement('div');
    textDiv.classList.add('message-text');

    if (attachment) {
        const attachmentDiv = document.createElement('div');
        attachmentDiv.classList.add('message-attachment');

        const fileIcon = document.createElement('i');
        fileIcon.classList.add('fas', getFileIconClass(attachment.file.name), 'file-icon');

        const fileInfoDiv = document.createElement('div');
        fileInfoDiv.classList.add('file-info');

        const fileName = document.createElement('div');
        fileName.classList.add('file-name');
        fileName.textContent = attachment.file.name;

        fileInfoDiv.appendChild(fileName);
        attachmentDiv.appendChild(fileIcon);
        attachmentDiv.appendChild(fileInfoDiv);

        textDiv.appendChild(attachmentDiv);

        if (attachment.description) {
            const descDiv = document.createElement('div');
            descDiv.classList.add('attachment-description');
            descDiv.textContent = attachment.description;
            textDiv.appendChild(descDiv);
        }

        if (text) {
            const textContent = document.createElement('div');
            textContent.innerHTML = formatMarkdown(text);
            textDiv.appendChild(textContent);
        }
    } else {
        textDiv.innerHTML = formatMarkdown(text);
    }

    if (isError) textDiv.style.color = '#f28b82';
    if (isWelcome) textDiv.style.fontWeight = '500';

    headerDiv.appendChild(senderDiv);
    headerDiv.appendChild(timeDiv);
    contentDiv.appendChild(headerDiv);
    contentDiv.appendChild(textDiv);
    messageDiv.appendChild(avatarDiv);
    messageDiv.appendChild(contentDiv);



// --- Add reaction/copy buttons below each message (only for bot messages) ---
if (sender === 'bot') {
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'message-actions';

    // Copy button
    const copyBtn = document.createElement('button');
    copyBtn.className = 'msg-action-btn copy-btn';
    copyBtn.title = 'Copy';
    copyBtn.innerHTML = '<i class="fa-regular fa-copy"></i>';
    copyBtn.onclick = function () {
        // Copy the message text (without HTML tags)
        let textToCopy = textDiv.innerText || textDiv.textContent;
        navigator.clipboard.writeText(textToCopy).then(() => {
            const icon = copyBtn.querySelector('i');
            icon.classList.remove('fa-copy', 'fa-regular');
            icon.classList.add('fa-solid', 'fa-check');
            setTimeout(() => {
                icon.classList.remove('fa-solid', 'fa-check');
                icon.classList.add('fa-regular', 'fa-copy');
            }, 1000);
        });
    };

    actionsDiv.appendChild(copyBtn);
    contentDiv.appendChild(actionsDiv);
}

messagesContainer.appendChild(messageDiv);
scrollToBottom();
if (window.MathJax && MathJax.typesetPromise) {
    MathJax.typesetPromise([messageDiv]);
}
initializeQuestionCardLogic(messageDiv);
}


// Helper function to generate a hash code for a string
String.prototype.hashCode = function () {
    let hash = 0;
    for (let i = 0; i < this.length; i++) {
        const char = this.charCodeAt(i);
        hash = (hash << 5) - hash + char;
        hash |= 0; // Convert to 32-bit integer
    }
    return hash;
};

function formatMarkdown(text) {
    // Process Markdown tables
    text = text.replace(/^([^\S\r\n]*\|[^\n]+\|.*)\r?\n([^\S\r\n]*\|[\s\-:|\r\n]+\|.*)\r?\n((?:[^\S\r\n]*\|[^\n]+\|.*(?:\r?\n|$))+)/gm, 
    function(match, headers, dividers, rows) {
        try {
            // Escape HTML and split headers
            const headerCells = headers.split('|')
                .map(cell => cell.trim().replace(/</g, '&lt;').replace(/>/g, '&gt;'))
                .filter(cell => cell)
                .map(cell => `<th>${cell}</th>`)
                .join('');

            // Process rows
            const tableRows = rows.split(/\r?\n/)
                .filter(row => row.trim() && row.includes('|'))
                .map(row => {
                    const cells = row.split('|')
                        .map(cell => cell.trim().replace(/</g, '&lt;').replace(/>/g, '&gt;'))
                        .filter(cell => cell);
                    return `<tr>${cells.map(c => `<td>${c}</td>`).join('')}</tr>`;
                })
                .join('');

            return `
<div class="markdown-table-container">
    <table class="markdown-table">
        <thead><tr>${headerCells}</tr></thead>
        <tbody>${tableRows}</tbody>
    </table>
</div>`;
        } catch (e) {
            console.error("Table processing error:", e);
            return match; // Return original on error
        }
    });

    // Process fractions (special case)
    text = text.replace(/\?fra (\d+)\/(\d+) \?\?/g, 
        '<span class="frac"><sup>$1</sup><sub>$2</sub></span>');

    // Process inline LaTeX math (e.g., $E=mc^2$)
    text = text.replace(/\$(.+?)\$/g, (_, math) => `\\(${math}\\)`);

    // Process block LaTeX math (e.g., $$E=mc^2$$)
    text = text.replace(/\$\$(.+?)\$\$/gs, (_, math) => `\\[${math}\\]`);

    // Process standard markdown
text = text.replace(/^# (.*$)/gm, '<h1>$1</h1>');
text = text.replace(/^## (.*$)/gm, '<h2>$1</h2>');
text = text.replace(/^### (.*$)/gm, '<h3>$1</h3>');
text = text.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
text = text.replace(/^##### (.*$)/gm, '<h5>$1</h5>');
text = text.replace(/\*\*(.*?)\*\*/g, '<strong style="font-weight: 1000;">$1</strong>');
text = text.replace(/\*(.*?)\*/g, '<em style="font-weight: 100;">$1</em>');
text = text.replace(/`([^`]+)`/g, '<code class="inline-code">$1</code>');
text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
text = text.replace(/^---$/gm, '<hr>');
text = text.replace(/#pro#(.*?)#pro#/g, '<p class="logo-beta">$1</p>');
text = text.replace(/#un#(.*?)#un#/g, '<span class="underline">$1</span>');

text = text.replace(/\*/g, '•');
text = text.replace(/#qu#(.*?)#qu#/g, '<p class="quote">$1</p>');
text = text.replace(/#lt#/g, '    <img src="lt-ai.png" alt="Maths" class="foldery">');
text = text.replace(/fuck/g, '  f***');
text = text.replace(/bitch/g, '  b***');
text = text.replace(/#shake#(.*?)#shake#/g, '<p class="shake">$1</p>');

// Process paragraphs (must be last)
text = text.replace(/(\n\n)(?!<[a-z])(.*?)(?=\n\n|$)/gs, '<p>$2</p>');



return text;
}




function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

function copyCode(button) {
    const codeBlock = button.previousElementSibling;
    const range = document.createRange();
    range.selectNode(codeBlock);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    
    try {
        document.execCommand('copy');
        button.textContent = 'Copied!';
        setTimeout(() => {
            button.textContent = 'Copy';
        }, 2000);
    } catch (err) {
        console.error('Failed to copy:', err);
    }
    
    window.getSelection().removeAllRanges();
}

function formatTime(date) {
    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function showLoadingIndicator() {
    const id = "loading-" + Date.now();
    const loadingDiv = document.createElement('div');
    loadingDiv.id = id;
    loadingDiv.classList.add('message', 'message-bot');
    
    const avatarDiv = document.createElement('div');
    avatarDiv.classList.add('message-avatar');
    avatarDiv.innerHTML = '<img src="lt-ai.png"></img>';
    
    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');
    
    const headerDiv = document.createElement('div');
    headerDiv.classList.add('message-header');
    
    const senderDiv = document.createElement('div');
    senderDiv.classList.add('message-sender');
    senderDiv.textContent = 'LT AI';
    
    const timeDiv = document.createElement('div');
    timeDiv.classList.add('message-time');
    timeDiv.textContent = formatTime(new Date());
    
    const typingDiv = document.createElement('div');
    typingDiv.classList.add('typing-indicator');
    typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    `;
    
    headerDiv.appendChild(senderDiv);
    headerDiv.appendChild(timeDiv);
    contentDiv.appendChild(headerDiv);
    contentDiv.appendChild(typingDiv);
    loadingDiv.appendChild(avatarDiv);
    loadingDiv.appendChild(contentDiv);
    
    messagesContainer.appendChild(loadingDiv);
    scrollToBottom();
    return id;
}

function removeLoadingIndicator(id) {
    const element = document.getElementById(id);
    if (element) element.remove();
}

function scrollToBottom() {
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function setupTextareaAutoResize() {
    userInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
}

function clearConversation() {
    conversationHistory = [
        SYSTEM_INSTRUCTIONS,
        {
            role: "model",
            parts: [{ text: "Okay, I have cleared the conversation." }]
        }
    ];
    messagesContainer.innerHTML = '';
    displayMessage({
        text: "Okay, I have cleared the conversation.",
        sender: 'bot'
    });
}

function getFileType(filename) {
    const extension = filename.split('.').pop().toLowerCase();
    switch (extension) {
        case 'txt': return 'Text';
        case 'md':  return 'Markdown';
        case 'json': return 'JSON';
        case 'csv': return 'CSV';
        case 'docx':
        case 'doc': return 'Word Document';
        case 'ppt':
        case 'pptx': return 'PowerPoint Presentation';
        case 'xls':
        case 'xlsx': return 'Excel Spreadsheet';
        case 'pdf': return 'PDF Document';
        case 'png':
        case 'jpg':
        case 'jpeg': return 'Image';
        default:  return 'File';
    }
}

function getFileIconClass(filename) {
    const extension = filename.split('.').pop().toLowerCase();
    switch (extension) {
        case 'pdf': return 'fa-file-pdf';
        case 'doc':
        case 'docx': return 'fa-file-word';
        case 'xls':
        case 'xlsx': return 'fa-file-excel';
        case 'ppt':
        case 'pptx': return 'fa-file-powerpoint';
        case 'txt':
        case 'md': return 'fa-file-alt';
        case 'zip':
        case 'rar': return 'fa-file-archive';
        case 'jpg':
        case 'jpeg':
        case 'png':
        case 'gif': return 'fa-file-image';
        case 'mp3':
        case 'wav': return 'fa-file-audio';
        case 'mp4':
        case 'mov': return 'fa-file-video';
        default: return 'fa-file';
    }
}




function initializeQuestionCardLogic(container = document) {
    const questionCards = container.querySelectorAll('.question-card');

    questionCards.forEach(card => {
        const correctAnswer = card.querySelector('[ans-data-value]').getAttribute('ans-data-value');

        card.querySelectorAll('.choice-card').forEach(choice => {
            choice.addEventListener('click', function () {
                // Remove previous selections
                card.querySelectorAll('.choice-card').forEach(c => {
                    c.classList.remove('selected', 'correct', 'incorrect');
                });

                // Mark selected
                this.classList.add('selected');

                // Check answer after delay
                setTimeout(() => {
                    const selectedValue = this.getAttribute('data-value');

                    if (selectedValue === correctAnswer) {
                        this.classList.add('correct');
                    } else {
                        this.classList.add('incorrect');
                        card.querySelector(`.choice-card[data-value="${correctAnswer}"]`).classList.add('correct');
                    }
                }, 500);
            });
        });
    });
}


// Event listener for the send button
sendButton.addEventListener('click', () => {
    sendMessage(); // Trigger the sendMessage function
});

// Event listener for the Enter key
userInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault(); // Prevent adding a new line
        sendMessage(); // Trigger the sendMessage function
    }
});
clearButton.addEventListener('click', clearConversation);

settingsButton.addEventListener('click', () => {
    settingsPopup.classList.add('show');
});

settingsClose.addEventListener('click', () => {
    settingsPopup.classList.remove('show');
});

settingsCancel.addEventListener('click', () => {
    settingsPopup.classList.remove('show');
});

settingsSave.addEventListener('click', () => {
    API_KEY = apiTokenInput.value.trim();
    SYSTEM_INSTRUCTIONS_TEXT = systemInstructionsInput.value.trim();
    SYSTEM_INSTRUCTIONS = {
        role: "user",
        parts: [{
            text: SYSTEM_INSTRUCTIONS_TEXT
        }]
    };
    conversationHistory[0] = SYSTEM_INSTRUCTIONS;
    localStorage.setItem('apiKey', API_KEY);
    localStorage.setItem('systemInstructions', SYSTEM_INSTRUCTIONS_TEXT);
    settingsPopup.classList.remove('show');
    displayMessage({ text: "Settings saved!", sender: 'bot'});
});

attachmentButton.addEventListener('click', () => {
    attachmentPopup.classList.add('show');
});

attachmentClose.addEventListener('click', () => {
    attachmentPopup.classList.remove('show');
});

attachmentCancel.addEventListener('click', () => {
    attachmentPopup.classList.remove('show');
    fileInput.value = '';
    fileDescriptionInput.value = '';
    attachedFile = null;
    attachmentDescriptionLabel.textContent = '';
});

fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        attachedFile = file;
        attachmentDescriptionLabel.textContent = `Selected File: ${file.name}`;
    } else {
        attachedFile = null;
        attachmentDescriptionLabel.textContent = '';
    }
});



// Initialize the app
initApp();






function scrollToBottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

scrollToBottom();


    </script>
    <!-- For Word docs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
<!-- For Excel files -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


</body>
</html>




